<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start" (click)="back()">
      <ion-back-button defaultHref="/" color="dark" icon="arrow-back"></ion-back-button>
    </ion-buttons>
    <div class="header-container">
      <h3>All Categories</h3>
      <div class="header-icons">
        <ion-icon name="search-outline" (click)="gotoSearch()"></ion-icon>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-light">
  
  @if (isLoading) {
    <div class="split-layout">
    <div class="sidebar">
      <div class="cat-tab" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]">
        <div class="img-circle" style="background: transparent;">
          <ion-skeleton-text animated style="width: 100%; height: 100%; border-radius: 50%;"></ion-skeleton-text>
        </div>
        <ion-skeleton-text animated style="width: 40px; height: 10px; margin-top: 8px; border-radius: 4px;"></ion-skeleton-text>
      </div>
    </div>

    <div class="main-content">
      <div class="content-header">
        <ion-skeleton-text animated style="width: 150px; height: 24px; border-radius: 4px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 80px; height: 14px; margin-top: 4px; border-radius: 4px;"></ion-skeleton-text>
      </div>

      <div class="product-grid">
        <div *ngFor="let i of [1,2,3,4,5,6]" style="margin-bottom: 16px;">
          <ion-skeleton-text animated style="width: 100%; height: 140px; border-radius: 12px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 90%; height: 14px; margin-top: 8px; border-radius: 4px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 60%; height: 14px; margin-top: 4px; border-radius: 4px;"></ion-skeleton-text>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
            <ion-skeleton-text animated style="width: 40%; height: 18px; border-radius: 4px;"></ion-skeleton-text>
            <ion-skeleton-text animated style="width: 60px; height: 30px; border-radius: 6px;"></ion-skeleton-text>
          </div>
        </div>
      </div>
    </div>
  </div>
  } @else if (isError) {
    <app-error 
      title="Failed to Load Categories" 
      subtitle="Please check your internet connection and try again."
      buttonText="Retry"
      (retry)="getCategories()">
    </app-error>
  } @else {
    <div class="split-layout">
    
    <div class="sidebar">
      <div 
        class="cat-tab" 
        *ngFor="let cat of categories" 
        [class.active]="selectedCategory === cat.name"
        (click)="selectCategory(cat.name)">
        
        <div class="img-circle">
          <img [src]="cat.img" />
        </div>
        <span>{{cat.name}}</span>
        
        <div class="active-strip" *ngIf="selectedCategory === cat.name"></div>
      </div>
      <div style="height: 200px"></div>
    </div>

    <div class="main-content">
      
      <div class="content-header">
        <h4>{{selectedCategory | titlecase}}</h4>
        <small>{{products.length}} items</small>
      </div>

      <div class="product-grid">
        <app-product-card 
          *ngFor="let p of products"
          [product]="p"
          [qty]="getQty(p.id)"
          (increase)="increase($event)"
          (decrease)="decrease($event)"
          (itemClicked)="goToDetails($event)">
      </app-product-card>
      </div>
      
      <div style="height: 80px"></div>
    </div>

  </div>
  }

</ion-content>