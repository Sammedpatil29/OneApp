<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/" icon="arrow-back"></ion-back-button>
    </ion-buttons>
    
    <!-- <ion-buttons slot="end">
      <ion-button>
        <ion-icon name="share-social-outline"></ion-icon>
      </ion-button>
      <ion-button>
        <ion-icon name="heart-outline"></ion-icon>
      </ion-button>
    </ion-buttons> -->
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-white">
  
  @if (isLoading) {
    <div>
      <div style="height: 45vh; width: 100%; background: #f4f4f4;">
        <ion-skeleton-text animated style="width: 100%; height: 100%; margin: 0;"></ion-skeleton-text>
      </div>

      <div style="padding: 16px;">
        <ion-skeleton-text animated style="width: 30%; height: 14px; border-radius: 4px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 80%; height: 28px; margin-top: 8px; border-radius: 4px;"></ion-skeleton-text>
        <div style="margin-top: 16px; display: flex; align-items: center; gap: 10px;">
          <ion-skeleton-text animated style="width: 80px; height: 24px; border-radius: 4px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 60px; height: 18px; border-radius: 4px;"></ion-skeleton-text>
        </div>
      </div>
      
      <hr class="divider">
      
      <div style="padding: 16px;">
        <ion-skeleton-text animated style="width: 40%; height: 20px; margin-bottom: 12px; border-radius: 4px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 100%; height: 14px; margin-bottom: 6px; border-radius: 4px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 70%; height: 14px; margin-bottom: 6px; border-radius: 4px;"></ion-skeleton-text>
      </div>
    </div>

  } @else if (isError) {
    <app-error 
      title="Oops! Item details failed to load" 
      (reload)="getDetails()">
    </app-error>

  } @else {
    <div>
      
      <div class="image-container">
        <div class="main-img">
          <img [src]="product.image_url" alt="{{product.name}}" />
        </div>
        </div>

      <div class="info-section">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <small class="brand text-muted">{{product.brand}}</small>
            <h1>{{product.name}}</h1>
          </div>
        </div>

        <div class="weight-row">{{product.unit_value | number:'1.0-0'}} {{product.unit}}</div>

        <div class="price-block">
          <span class="curr">₹{{product.price - product.discount}}</span>
          
          @if (product.discount > 0) {
            <span class="old">₹{{product.price}}</span>
            <span class="disc-tag">{{(product.discount/product.price)*100 | number:'1.0-0'}}% OFF</span>
          }
        </div>
        <p class="tax-note">(Inclusive of all taxes)</p>
      </div>

      <hr class="divider">

      <div class="details-section">
        <h4>Product Details</h4>
        <p [class.collapsed]="!isExpanded">
          {{product.description}}
        </p>
        <span class="read-more" (click)="isExpanded = !isExpanded">
          {{ isExpanded ? 'Read Less' : 'Read More' }}
        </span>

        <div class="highlights">
          <div class="hl-item">
            <ion-icon name="leaf-outline" class="hl-icon text-success"></ion-icon>
            <strong>Hybrid</strong>
          </div>
          <div class="hl-item">
            <ion-icon name="hourglass-outline" class="hl-icon text-warning"></ion-icon>
            <strong>3 Days</strong>
          </div>
          <div class="hl-item">
            <ion-icon name="globe-outline" class="hl-icon text-primary"></ion-icon>
            <strong>Indian</strong>
          </div>
          <div class="hl-item">
            <ion-icon name="alert-circle-outline" class="hl-icon text-danger"></ion-icon>
            <strong>No Return</strong>
          </div>
        </div>
      </div>

      <hr class="divider">

      <div class="similar-section">
        <h4>You might also like</h4>
        <div class="product-scroll">
            <app-product-card 
              *ngFor="let p of similarProducts"
              [product]="p"
              [qty]="getQty(p.id)"
              (increase)="increase($event)"
              (decrease)="decrease($event)"
              (itemClicked)="goToDetails($event)">
          </app-product-card>
        </div>
      </div>

      <div style="height: 100px;"></div>
    </div>
  }

</ion-content>

@if (!isLoading && !isError && product) {
  <ion-footer class="sticky-footer">
    <div class="action-container">
      
      <div class="unit-toggle">
        <span>{{product.unit_value | number:'1.0-0'}} {{product.unit}}</span>
        <small>₹{{product.price - product.discount}}</small>
      </div>

      <button class="big-add-btn" 
              *ngIf="product.stock === 0" 
              disabled
              style="opacity: 0.7; background-color: #dcdcdc; color: #555; border: none;">
        OUT OF STOCK
      </button>

      <button class="big-add-btn" 
              *ngIf="product.stock !== 0 && getQty(product.id) === 0" 
              (click)="$event.stopPropagation(); increase(product.id)">
        ADD TO CART
      </button>

      <div class="big-counter" *ngIf="product.stock !== 0 && getQty(product.id) > 0">
        <div class="btn" (click)="$event.stopPropagation(); decrease(product.id)">-</div>
        <div class="val">{{ getQty(product.id) }}</div>
        <div class="btn" (click)="$event.stopPropagation(); increase(product.id)">+</div>
      </div>

    </div>
  </ion-footer>
}