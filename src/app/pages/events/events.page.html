<ion-content [fullscreen]="true" class="bg-gray-50">
  
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  @if (isLoading) {
    <div class="p-2 pt-14">
      <div class="flex gap-4 overflow-hidden mb-6">
        <ion-skeleton-text animated style="width: 85%; height: 200px; border-radius: 20px; flex-shrink: 0;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 15%; height: 200px; border-radius: 20px 0 0 20px; flex-shrink: 0;"></ion-skeleton-text>
      </div>
      <div class="flex gap-3 mb-6">
        <ion-skeleton-text animated style="width: 80px; height: 36px; border-radius: 18px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 80px; height: 36px; border-radius: 18px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="width: 80px; height: 36px; border-radius: 18px;"></ion-skeleton-text>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <ion-skeleton-text animated style="height: 220px; border-radius: 16px;" *ngFor="let i of [1,2,3,4]"></ion-skeleton-text>
      </div>
    </div>
  } 

  @else {
    <div class="sticky-header-section">
      <ion-header>
  <ion-toolbar class="pt-4">
    <ion-buttons slot="start">
      <ion-button (click)="back()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Local Events</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="openHelp()">
        <ion-icon name="help-circle-outline" slot="icon-only" color="medium"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>
      <div class="px-4 mb-2">
        <ion-searchbar 
          mode="ios" 
          placeholder="Search concerts, workshops..." 
          class="custom-search"
          (ionInput)="handleSearch($event)">
        </ion-searchbar>
      </div>

      <div class="horizontal-scroll-container px-4 pb-4">
        <div class="category-pill" [class.active]="currentFilter === 'All'" (click)="applyFilter('All')">All</div>
        <div class="category-pill" [class.active]="currentFilter === 'Upcoming'" (click)="applyFilter('Upcoming')">Upcoming</div>
        @for (item of categories; track item) {
          <div class="category-pill" [class.active]="currentFilter === item" (click)="applyFilter(item)">
            {{ item | titlecase }}
          </div>
        }
      </div>
    </div>

    <div class="content-container pb-24">
      
      @if(currentFilter === 'All' && !searchTerm) {
        <div class="mb-6">
          <div class="flex items-end justify-between px-4 mb-3">
            <h2 class="text-lg font-bold text-gray-800 m-0">Featured</h2>
            <!-- <span class="text-xs font-semibold text-primary">See All</span> -->
          </div>
          
          <div class="featured-scroll px-4">
            @for (feat of featuredEvents; track feat) {
              <div class="featured-card" (click)="openItemModal(feat)">
                <img [src]="feat.imageUrl || 'https://dummyimage.com/600x800/eee/aaa?text=Event'" alt="Event" loading="lazy">
                <div class="overlay">
                  <span class="feat-badge">{{feat.category}}</span>
                  <h3>{{feat.title}}</h3>
                  <p><ion-icon name="calendar-outline"></ion-icon> {{feat.date | date:'EEE, d MMM'}}</p>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <div class="px-4">
        <h2 class="text-lg font-bold text-gray-800 mb-3">
          {{ searchTerm ? 'Search Results' : (currentFilter === 'All' ? 'Popular Events' : (currentFilter | titlecase) + ' Events') }}
        </h2>

        @if(filteredEvents.length === 0) {
          <div class="text-center py-10 text-gray-400">
            <ion-icon name="search-outline" class="text-4xl mb-2"></ion-icon>
            <p>No events found</p>
          </div>
        }

        <div class="event-masonry-grid">
          @for (card of filteredEvents; track card) {
            <div class="modern-event-card animate__animated animate__fadeIn" (click)="openItemModal(card)">
              <div class="card-image-box">
                <img [src]="card.imageUrl || 'https://dummyimage.com/600x800/eee/aaa?text=Event'" loading="lazy">
                
                <div class="price-tag" [class.free]="card.isFree">
                  {{ card.isFree ? 'FREE' : ('â‚¹' + card.ticketPrice) }}
                </div>
                
                <button class="fav-btn" (click)="toggleFavorite(card, $event)">
                  <ion-icon [name]="card.isFavorite ? 'heart' : 'heart-outline'" [color]="card.isFavorite ? 'danger' : 'medium'"></ion-icon>
                </button>
              </div>

              <div class="card-info">
                <div class="date-badge">
                  <span class="month">{{ card.date | date:'MMM' }}</span>
                  <span class="day">{{ card.date | date:'dd' }}</span>
                </div>
                <div class="details">
                  <h3 class="card-name text-truncate-2 text-wrap">{{card.title}}</h3>
                  <p class="location text-truncate text-wrap">
                    <ion-icon name="location-outline"></ion-icon> {{ card.location.location || 'Bangalore' }}
                  </p>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <ion-fab vertical="bottom" horizontal="center" slot="fixed" class="mb-4">
      <ion-fab-button color="dark" (click)="openBookings()" class="extended-fab">
        <!-- <ion-icon name="ticket-outline" class="mr-2"></ion-icon> -->
         @if(upcomingBookings.length == 0){
           <span class="font-bold">My Bookings</span>
         } @else {
           <span class="font-bold">Upcoming ({{upcomingBookings.length}})</span>
         }
      </ion-fab-button>
    </ion-fab>

  }

  <app-footer></app-footer>
</ion-content>