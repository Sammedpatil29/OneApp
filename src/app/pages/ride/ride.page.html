@if (!isLoading) {
  <ion-content [fullscreen]="true">

@if(!isAddressSelected){

<section>

<!-- TOP BAR -->
<div class="topbar bg-white position-sticky pt-4">

  <ion-title class="title-row">
    <div class="back-row" (click)="goBack()">
      <svg class="me-2" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px">
        <path d="M400-240 160-480l240-240 56 58-142 142h486v80H314l142 142-56 58Z"/>
      </svg>
      {{selectedInput}}
    </div>
  </ion-title>

  <!-- INPUTS -->
  <div class="inputs-wrapper">

    <!-- PICKUP -->
    <div class="input-row">
      <div class="dot green"></div>

      <input class="location-input"
        [(ngModel)]="pickup"
        (input)="onInputChange('Pickup')"
        placeholder="Pickup"
        (focus)="selectedInput = 'Pickup'"
        type="text">

      @if(pickup != ''){
        <div class="clear-btn" (click)="pickup = ''">
          ✕
        </div>
      }
    </div>

    <div class="line"></div>

    <!-- DROP -->
    <div class="input-row">
      <div class="dot orange"></div>

      <input class="location-input"
        #dropInput
        [(ngModel)]="drop"
        (input)="onInputChange('Drop')"
        placeholder="Drop"
        (focus)="selectedInput = 'Drop'"
        type="text">

      @if(drop != ''){
        <div class="clear-btn" (click)="drop = ''">
          ✕
        </div>
      }
    </div>

    <!-- MAP SELECT -->
    <button class="map-btn">
      <small>
        <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px">
          <path d="M460-420h40v-120h120v-40H500v-120h-40v120H340v40h120v120Z"/>
        </svg>
        Select on map
      </small>
    </button>

  </div>
</div>
<!-- TOP BAR END -->

<!-- RESULTS -->
@if (filteredPredictions.length != 0 || filteredPredictionsOut.length != 0 || filteredHistory.length != 0) {

@if(filteredHistory.length > 0){
  <ion-title class="list-title">Recent</ion-title>
}

@for(item of filteredHistory; track $index){
  <div class="result-card gap-3" (click)="setPickupDropbyHistory(item)">
    <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M480-100q-147.06 0-255.22-97.04T102-440h61q14.62 121 105.23 200.5Q358.85-160 480-160q134 0 227-93t93-227q0-134-93-227t-227-93q-90.23 0-166.04 46.35-75.81 46.34-116.88 127.11h118.3v60H110.31q30.15-129.23 133.42-211.34Q347-860 480-860q78.85 0 148.2 29.92t120.65 81.21q51.3 51.29 81.22 120.63Q860-558.9 860-480.07q0 78.84-29.93 148.21-29.92 69.37-81.22 120.68T628.2-129.93Q558.85-100 480-100Zm108.92-228.92L450-467.9v-197.48h60v173.23l120.69 121.07-41.77 42.16Z"/></svg>
    </div>
    <div class="text">
      <b>{{item.name}}</b>
      <small>{{item.formatted_address}}</small>
    </div>
  </div>
}

@if(filteredPredictions.length > 0){
  <ion-title class="list-title">Local</ion-title>
}

@for(item of filteredPredictions; track $index){
  <div class="result-card gap-3" (click)="setPickupDropbyHistory(item)">
    <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M480-100q-147.06 0-255.22-97.04T102-440h61q14.62 121 105.23 200.5Q358.85-160 480-160q134 0 227-93t93-227q0-134-93-227t-227-93q-90.23 0-166.04 46.35-75.81 46.34-116.88 127.11h118.3v60H110.31q30.15-129.23 133.42-211.34Q347-860 480-860q78.85 0 148.2 29.92t120.65 81.21q51.3 51.29 81.22 120.63Q860-558.9 860-480.07q0 78.84-29.93 148.21-29.92 69.37-81.22 120.68T628.2-129.93Q558.85-100 480-100Zm108.92-228.92L450-467.9v-197.48h60v173.23l120.69 121.07-41.77 42.16Z"/></svg>
    </div>
    <div class="text">
      <b>{{item.name}}</b>
      <small>{{item.formatted_address}}</small>
    </div>
  </div>
}

@if(filteredPredictionsOut.length > 0){
  <ion-title class="list-title">Out Station</ion-title>
}

@for(item of filteredPredictionsOut; track $index){
  <div class="result-card gap-3" (click)="setPickupDropbyHistory(item)">
    <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M480-100q-147.06 0-255.22-97.04T102-440h61q14.62 121 105.23 200.5Q358.85-160 480-160q134 0 227-93t93-227q0-134-93-227t-227-93q-90.23 0-166.04 46.35-75.81 46.34-116.88 127.11h118.3v60H110.31q30.15-129.23 133.42-211.34Q347-860 480-860q78.85 0 148.2 29.92t120.65 81.21q51.3 51.29 81.22 120.63Q860-558.9 860-480.07q0 78.84-29.93 148.21-29.92 69.37-81.22 120.68T628.2-129.93Q558.85-100 480-100Zm108.92-228.92L450-467.9v-197.48h60v173.23l120.69 121.07-41.77 42.16Z"/></svg>
    </div>
    <div class="text">
      <b>{{item.name}}</b>
      <small>{{item.formatted_address}}</small>
    </div>
  </div>
}

} @else {

@for(item of userHistory; track $index){
  <div class="result-card gap-3" (click)="setPickupDropbyHistory(item)">
    <div class="icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000000"><path d="M480-100q-147.06 0-255.22-97.04T102-440h61q14.62 121 105.23 200.5Q358.85-160 480-160q134 0 227-93t93-227q0-134-93-227t-227-93q-90.23 0-166.04 46.35-75.81 46.34-116.88 127.11h118.3v60H110.31q30.15-129.23 133.42-211.34Q347-860 480-860q78.85 0 148.2 29.92t120.65 81.21q51.3 51.29 81.22 120.63Q860-558.9 860-480.07q0 78.84-29.93 148.21-29.92 69.37-81.22 120.68T628.2-129.93Q558.85-100 480-100Zm108.92-228.92L450-467.9v-197.48h60v173.23l120.69 121.07-41.77 42.16Z"/></svg>
    </div>
    <div class="text">
      <b>{{item.name}}</b>
      <small>{{item.formatted_address}}</small>
    </div>
  </div>
}

}

</section>

} @else {

<section>
  <app-ride-selection></app-ride-selection>
</section>

}

</ion-content>
} @else {
  <div class="loader-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Getting Rides Ready...</p>
    </div>
}
