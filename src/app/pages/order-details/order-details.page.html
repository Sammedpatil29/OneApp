<ion-header>
  <ion-toolbar class="pt-4">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Order Details</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding-horizontal">

  @if(isLoading) {
    <div class="d-flex justify-content-center align-items-center h-100">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
  } 
  @else {
    
    <div class="p-3 mt-3 border rounded-4 d-flex justify-content-between align-items-center bg-light">
      <div>
        <div class="fw-bold fs-5">{{eventData?.eventName}}</div>
        
        <div class="text-muted small" *ngIf="selectedOption">
          {{selectedOption.name | titlecase}} Ticket 
          <span class="fw-bold text-dark">₹{{unitPrice}}</span>
        </div>
        <div class="text-muted small" style="font-size: 11px;">
          {{eventData?.eventDate | date:'mediumDate'}}
        </div>
      </div>
      
      <div class="d-flex align-items-center bg-white border rounded-pill px-2 py-1 shadow-sm">
        <span class="px-2 fw-bold fs-4 text-secondary" (click)="count('-')">-</span>
        <span class="px-2 fw-bold fs-6">{{ticketCount}}</span>
        <span class="px-2 fw-bold fs-4 text-primary" (click)="count('+')">+</span>
      </div>
    </div>

    @if(ticketOptions.length > 1) {
      <ion-card-subtitle class="mt-4 ms-1 fw-bold text-dark">Select Ticket Class</ion-card-subtitle>
      <ion-item lines="none" class="border rounded-4 mt-2">
        <ion-select 
          [value]="selectedOption" 
          (ionChange)="onTicketSelect($event.detail.value)" 
          interface="action-sheet" 
          placeholder="Select Class"
          class="w-100 fw-bold">
          <ion-select-option *ngFor="let opt of ticketOptions" [value]="opt">
            {{opt.name | titlecase}} - ₹{{opt.price}}
          </ion-select-option>
        </ion-select>
      </ion-item>
    }

    <ion-card-subtitle class="mt-4 ms-1 fw-bold text-dark">Personal Details</ion-card-subtitle>
    <ion-item lines="none" class="border rounded-4 mt-2 bg-light">
      <ion-input placeholder="Full Name" [(ngModel)]="customerName"></ion-input>
    </ion-item>
    <ion-item lines="none" class="border rounded-4 mt-2 bg-light">
      <ion-input placeholder="Phone Number" type="tel" maxlength="10" [(ngModel)]="mobileNumber"></ion-input>
    </ion-item>
    <ion-item lines="none" class="border rounded-4 mt-2 bg-light">
      <ion-input placeholder="Email Address" type="email" [(ngModel)]="email"></ion-input>
    </ion-item>

    <ion-card-subtitle class="mt-4 ms-1 fw-bold text-dark">Price Details</ion-card-subtitle>
    <div class="border rounded-4 mt-2 p-3 mb-5 bg-white shadow-sm">
      <div class="d-flex justify-content-between mb-2">
        <span>Base Price ({{ticketCount}} x ₹{{unitPrice}})</span>
        <span class="fw-medium">₹{{basePrice}}</span>
      </div>
      <div class="d-flex justify-content-between mb-2 text-muted">
        <span>Platform Charges (7%)</span>
        <span>₹{{charges}}</span>
      </div>
      <hr class="my-2 dashed">
      <div class="d-flex justify-content-between fw-bold fs-5 text-dark">
        <span>Total Pay</span>
        <span>₹{{finalCost}}</span>
      </div>
    </div>
    <!-- <button (click)="dummycall()">dummy</button> -->

    <div style="height: 100px"></div>

    <!-- <div class="fixed-bottom bg-white p-3">
      <ion-button expand="block" color="dark" shape="round" class="py-2 book-btn w-100"
        [disabled]="!customerName || mobileNumber.length < 10" 
        (click)="payWithRazorpay()">
        PAY ₹{{finalCost}}
      </ion-button>
    </div> -->
    <div class="fixed-bottom bg-white p-3">
      <div style="position: relative; width: 100%; height: 60px; background-color: #222428; border-radius: 16px; display: flex; align-items: center; justify-content: center; overflow: hidden;">
        <div style="position: absolute; color: white; font-weight: 600; font-size: 16px; pointer-events: none; z-index: 1;">
          Slide to Pay {{finalCost | currency:'INR':'symbol':'1.0-0'}}
        </div>
        <ion-range min="0" max="100" value="0" mode="ios" 
          style="width: 100%; padding: 0; margin: 0; height: 100%; z-index: 2; --bar-background: transparent; --bar-background-active: transparent; --knob-background: #ffffff url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 512 512%22%3E%3Cpath fill=%22none%22 stroke=%22black%22 stroke-linecap=%22round%22 stroke-linejoin=%22round%22 stroke-width=%2248%22 d=%22M184 112l144 144-144 144%22/%3E%3C/svg%3E') no-repeat center center; --knob-background-size: 24px; --knob-size: 52px; --knob-border-radius: 14px; --knob-box-shadow: 0 2px 6px rgba(0,0,0,0.3); padding-inline-start: 30px; padding-inline-end: 30px;"
          (ionChange)="$event.detail.value == 100 ? PayNow() : $event.target.value = 0">
        </ion-range>
      </div>
  </div>
  }

  <ion-toast
    [isOpen]="isToastOpen"
    [message]="toastMessage"
    [duration]="3000"
  ></ion-toast>

</ion-content>