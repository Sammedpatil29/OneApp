<ion-content [fullscreen]="true">
  <div class="bg-decoration"></div>

  @if(!verifyingToken){
    @if (!showRegisterForm) {
    <ion-header class="ion-no-border pt-4">
      <ion-toolbar>
        <ion-buttons slot="start">
          <!-- <ion-button (click)="goBack()" class="back-btn">
            <ion-icon slot="icon-only" name="chevron-back"></ion-icon>
          </ion-button> -->
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <div class="login-wrapper main-container">
      <!-- <div class="header-section">
        <h1 class="brand-name">NIM</h1>
        <p class="brand-tagline">Needs in Minutes</p>
      </div> -->

      @if (!otpSent) {
        <div class="form-section mt-2">
          <h2 class="page-title">Welcome Back</h2>
          <p class="subtitle">Enter your phone number to get started</p>

          <div class="input-container">
            <div class="country-pill">+91</div>
            <ion-input
              [(ngModel)]="phoneNumber"
              type="tel"
              inputmode="numeric"
              maxlength="10"
              placeholder="00000 00000"
              class="modern-input">
            </ion-input>
          </div>
        </div>
      }

      @if (otpSent) {
        <div class="form-section animate__animated animate__fadeIn">
          <h2 class="page-title">Verify Details</h2>
          <p class="subtitle">Sent to <span class="phone-highlight">+91 {{phoneNumber}}</span></p>

          <div class="otp-wrapper">
            <ng-otp-input
              (onInputChange)="onOtpChange($event)"
              [config]="otpConfig">
            </ng-otp-input>
          </div>

          <div class="resend-wrapper">
            <p>
              Didnâ€™t receive the code? 
              @if(timer == 0){
                <span class="resend-link" (click)="sendVerification()">Resend Now</span>
              } @else {
                <span class="timer-text">Try again in <b>{{timer}}s</b></span>
              }
            </p>
          </div>
        </div>
      }
    </div>

    <div class="bottom-action-container">
      @if (!otpSent) {
        <ion-button
          color="dark"
          class="book-btn w-100"
          [disabled]="isSendingOtp || phoneNumber.length != 10"
          (click)="sendVerification()">
          <span *ngIf="!isSendingOtp">Continue</span>
          <ion-spinner *ngIf="isSendingOtp" name="dots"></ion-spinner>
        </ion-button>
      } @else {
        <ion-button
          expand="block"
          color="dark"
          mode="ios"
          class="book-btn w-100"
          [disabled]="isLoading || isSendingOtp"
          (click)="verifyOTP()">
          <span *ngIf="!isLoading">{{otpVerificationMessage || 'Verify & Proceed'}}</span>
          <ion-spinner *ngIf="isLoading" name="dots"></ion-spinner>
        </ion-button>
      }
    </div>
  } @else {
    <ion-header class="ion-no-border">
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="goBack()" class="back-btn">
            <ion-icon slot="icon-only" name="chevron-back"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <div class="login-wrapper main-container">
      <div class="header-section">
        <h2 class="page-title">Create Profile</h2>
        <p class="subtitle">Join the <b>Pintu</b> community today</p>
      </div>

      <div class="form-section">
        <div class="modern-field">
          <ion-label>Full Name</ion-label>
          <ion-input
            [(ngModel)]="fullName"
            placeholder="John Doe"
            class="outline-input">
          </ion-input>
        </div>

        <div class="modern-field mt-3">
          <ion-label>Email Address</ion-label>
          <ion-input
            [(ngModel)]="email"
            type="email"
            placeholder="john@example.com"
            class="outline-input">
          </ion-input>
        </div>
      </div>
    </div>

    <div class="bottom-action-container">
      <ion-button
        expand="block"
        mode="ios"
        color="dark"
        class="book-btn w-100"
        [disabled]="isLoading"
        (click)="login()">
        <span *ngIf="!isLoading">Complete Setup</span>
        <ion-spinner *ngIf="isLoading" name="dots"></ion-spinner>
      </ion-button>
    </div>
  }
  } @else {
    <div class="w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="background-color: #5e17eb">
      <img style="width: 250px" src="assets/icon/ic_launcher_foreground.png" alt="">
      <div class="spinner-border text-white" role="status">
  <span class="visually-hidden">Loading...</span>
</div>
    </div>
  }

  <ion-toast
    [isOpen]="isToastOpen"
    [message]="toastMessage"
    [duration]="3000"
    mode="ios"
    class="custom-toast">
  </ion-toast>
</ion-content>