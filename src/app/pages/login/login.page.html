<ion-content>

  <!-- ================= LOGIN FLOW ================= -->
  @if (!showRegisterForm) {

  <!-- HEADER -->
  <ion-header>
    <ion-toolbar class="pt-4">
      <ion-buttons slot="start">
        <ion-button (click)="goBack()">
          <ion-icon name="arrow-back"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-title>Login</ion-title>
    </ion-toolbar>
  </ion-header>

  <!-- CONTENT -->
  <div class="login-wrapper">

    <!-- PHONE INPUT -->
    @if (!otpSent) {
      <ion-card-title class="page-title">
        Login with Phone Number
      </ion-card-title>

      <ion-item class="custom-input">
        <ion-label position="start" class="country-code">+91</ion-label>
        <ion-input
          [(ngModel)]="phoneNumber"
          type="text"
          inputmode="numeric"
          maxlength="10"
          placeholder="Enter mobile number">
        </ion-input>
      </ion-item>
    }

    <!-- OTP INPUT -->
    @if (otpSent) {
      <ion-card-title class="page-title text-center">
        Enter OTP sent to +91 {{phoneNumber}}
      </ion-card-title>

      <div class="otp-wrapper">
        <ng-otp-input
          (onInputChange)="onOtpChange($event)"
          [config]="otpConfig">
        </ng-otp-input>
      </div>

      <div class="resend-wrapper">
        <p>
          Didnâ€™t get OTP?
          @if(timer == 0){
            <span class="resend" (click)="sendVerification()">Resend</span>
          } @else {
            Resend in <span class="text-primary">{{timer}}</span>s
          }
        </p>
      </div>
    }

  </div>

  <!-- FIXED BUTTON -->
  <div class="bottom-action">
    @if (!otpSent) {
      <ion-button
        expand="block"
        color="dark"
        [disabled]="isSendingOtp || phoneNumber.length != 10"
        (click)="sendVerification()">

        @if(isSendingOtp){
          <ion-spinner name="crescent"></ion-spinner>
        } @else {
          Send OTP
        }
      </ion-button>
    } @else {
      <ion-button
        expand="block"
        color="dark"
        [disabled]="isLoading || isSendingOtp"
        (click)="verifyOTP()">

        @if(isLoading || isSendingOtp){
          {{otpVerificationMessage}}
          <ion-spinner name="crescent"></ion-spinner>
        } @else {
          Verify OTP
        }
      </ion-button>
    }
  </div>

  }

  <!-- ================= REGISTRATION FLOW ================= -->
  @else {

  <ion-header>
    <ion-toolbar class="pt-4">
      <ion-buttons slot="start">
        <ion-button (click)="goBack()">
          <ion-icon name="arrow-back"></ion-icon>
        </ion-button>
      </ion-buttons>
      <ion-title>New User Registration</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="login-wrapper">

    <ion-card-title class="page-title">
      Welcome to OneApp ðŸ‘‹
    </ion-card-title>

    <p class="subtitle">
      Please enter your details to continue
    </p>

    <ion-input
      label="Full name"
      label-placement="floating"
      [(ngModel)]="fullName"
      fill="outline"
      placeholder="Enter your full name">
    </ion-input>

    <ion-input
      class="mt-3"
      label="Email"
      label-placement="floating"
      [(ngModel)]="email"
      fill="outline"
      placeholder="Enter your email">
    </ion-input>

  </div>

  <div class="bottom-action">
    <ion-button
      expand="block"
      color="dark"
      [disabled]="isLoading"
      (click)="login()">

      Submit
      @if (isLoading) {
        <ion-spinner name="crescent"></ion-spinner>
      }
    </ion-button>
  </div>

  }

  <!-- TOAST -->
  <ion-toast
    [isOpen]="isToastOpen"
    [message]="toastMessage"
    [duration]="3000">
  </ion-toast>

</ion-content>
