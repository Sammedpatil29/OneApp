@if(!isloading){
  <ion-header>
  <ion-toolbar class="pt-4">
    <ion-buttons slot="start">
      <ion-button (click)="goBack()">
        <ion-icon name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>History</ion-title>
  </ion-toolbar>

  <div class="d-flex align-items-center bg-white mx-3 pb-2">
    <div class="chip-scroll-container gap-0">
      @for (item of category; track $index) {
        <ion-chip 
          class="chip-item" 
          [outline]="true" 
          (click)="onCategoryChange($event)" 
          [ngClass]="selectedCategory.toLowerCase() === item.toLowerCase() ? 'active-chip' : ''">
          {{item | titlecase}}
        </ion-chip>
      }
    </div>

    <div class="ms-auto" style="border-radius: 20px"></div>
  </div>
</ion-header>
<ion-refresher slot="fixed" class="my-refresher mt-5" color="dark" (ionRefresh)="getHistory()"
   pullingIcon="arrow-dropdown" refreshingSpinner="crescent">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
<!-- <ion-content> -->
  @if (history.length) {
    <section>
      
      
      
      <div class="px-3 mb-5 mt-2">
        @for (item of filteredHistory; track $index) {
          <div class="history-card mb-1" (click)="openDetails(item)">
            <div class="card-body p-3">
              
              <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="date-badge">
                  {{item.created_at | date:'dd MMM'}} <span class="text-muted">â€¢</span> {{item.created_at | date: 'HH:mm'}}
                </span>
                <div class="status-badge" [class.success]="item.status === 'completed'" [class.success]="item.status === 'paid'" [class.danger]="item.status === 'cancelled'">
                  <i [ngClass]="getStatusIcon(item.status)" class="me-1"></i>
                  @if(item.status == 'paid'){
                    Upcoming
                  } @else {
                    {{item.status}}
                  }
                </div>
              </div>

              <div class="d-flex align-items-center justify-content-between mb-3">
                <h6 class="m-0 fw-bold text-dark text-truncate" style="max-width: 70%;">{{item.title}}</h6>
                <ion-icon name="chevron-forward" color="medium" style="font-size: 1.2rem; opacity: 0.5"></ion-icon>
              </div>

              <div class="card-footer-row d-flex justify-content-between align-items-end pt-2 border-top">
                <span class="type-pill">{{item.type}}</span>
                <span class="cost-text">&#8377;{{item.finalCost}}</span>
              </div>

            </div>
          </div>
        }
      </div>
    </section>
  } @else {
    <app-nodata></app-nodata>
  }
} @else {
  <div class="loader-state">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Loading History...</p>
    </div>
}
  
<!-- </ion-content> -->